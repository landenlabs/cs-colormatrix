Add-Type -AssemblyName System.IO.Compression.FileSystem
$in='Filters'; $out='filters.gzip'; $i=0
if(Test-Path $out){ Remove-Item $out }
$zip = [System.IO.Compression.ZipFile]::Open($out,'Create')
Get-ChildItem $in -Filter *.xml | ForEach-Object {
  $folder = "filter$($i++)/"
  [System.IO.Compression.ZipFileExtensions]::CreateEntryFromFile($zip, $_.FullName, $folder + 'table.xml',[System.IO.Compression.CompressionLevel]::Optimal)
  $labelEntry = $zip.CreateEntry($folder + 'label.txt')
  $s = $labelEntry.Open(); [System.Text.Encoding]::UTF8.GetBytes($_.BaseName) | % { $s.WriteByte($_) }; $s.Close()
  $img = [System.IO.Path]::ChangeExtension($_.FullName,'.png')
  if(Test-Path $img){ [System.IO.Compression.ZipFileExtensions]::CreateEntryFromFile($zip, $img, $folder + 'image.png',[System.IO.Compression.CompressionLevel]::Optimal) }
}
$zip.Dispose()
Write-Host "Wrote $out"
